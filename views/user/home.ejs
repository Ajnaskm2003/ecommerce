<%- include("../../views/partials/user/header") %>

<style>
/* ────────────────────── GLOBAL STYLES ────────────────────── */
body { font-family: 'Poppins', sans-serif; background: #f8f9fa; }
.section_gap { padding: 80px 0; }
.primary-btn {
    background: linear-gradient(45deg, #ff6b6b, #ff8e53);
    color: white; border-radius: 50px; padding: 12px 30px;
    transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(255,107,107,.3);
}
.primary-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(255,107,107,.4); }

/* HERO */
.banner-area { position: relative; height: 90vh; overflow: hidden; }
.banner-area::before {
    content: ''; position: absolute; inset: 0;
    background: linear-gradient(135deg, rgba(0,0,0,0.6), rgba(0,0,0,0.3)); z-index: 1;
}
.banner-content h1 { font-size: 4.5rem; font-weight: 700; }
.banner-img img { transition: transform 8s ease; }
.single-slide:hover .banner-img img { transform: scale(1.05); }

/* FEATURES */
.single-features { transition: all 0.3s; }
.single-features:hover { transform: translateY(-10px); }

/* CATEGORY GRID – FIXED ALIGNMENT */
.category-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
}
.category-item {
    position: relative; overflow: hidden; border-radius: 16px;
    box-shadow: 0 6px 20px rgba(0,0,0,.1); aspect-ratio: 1/1;
}
.category-item img {
    width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease;
}
.category-item:hover img { transform: scale(1.12); }
.category-overlay {
    position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
    background: rgba(0,0,0,0.4); backdrop-filter: blur(3px); color: white; font-weight: 600;
    font-size: 1.5rem; text-transform: uppercase; letter-spacing: 1px;
}

/* PRODUCT CARD */
.single-product {
    background: white; border-radius: 16px; overflow: hidden;
    box-shadow: 0 5px 20px rgba(0,0,0,.08); transition: all 0.4s ease;
}
.single-product:hover {
    transform: translateY(-12px); box-shadow: 0 15px 35px rgba(255,107,107,.2);
}
.single-product img { height: 250px; object-fit: cover; }
.price .l-through { text-decoration: line-through; color: #aaa; font-size: 0.9rem; }
.discount-badge {
    position: absolute; top: 12px; left: 12px; background: #ff4757;
    color: white; font-size: 0.8rem; padding: 4px 10px; border-radius: 20px;
    font-weight: 600; z-index: 2;
}

/* EXCLUSIVE DEAL */
.clockdiv .clockinner h1 { font-size: 2.8rem; }

/* DEALS OF THE WEEK */
.single-related-product {
    transition: all 0.3s; border-radius: 12px; overflow: hidden;
    box-shadow: 0 3px 12px rgba(0,0,0,.05);
}
.single-related-product:hover { transform: translateX(8px); box-shadow: 0 8px 25px rgba(255,107,107,.15); }
</style>

<!-- ===================== HERO BANNER ===================== -->
<section class="banner-area">
    <div class="container h-100">
        <div class="row h-100 align-items-center">
            <div class="col-lg-12">
                <div class="active-banner-slider owl-carousel">
                    <div class="single-slide position-relative">
                        <div class="banner-img">
                            <img class="img-fluid w-100" src="/img/@psyche.jpeg" alt="Hero">
                        </div>
                        <div class="banner-content position-absolute top-50 start-0 translate-middle-y ps-5" style="z-index:2;">
                            <h1 class="text-white mb-3">Summer Sale<br><span style="color:#ff6b6b;">Up to 50% Off</span></h1>
                            <p class="text-white mb-4">Grab the hottest deals before they're gone!</p>
                            <a href="/shop" class="primary-btn">Shop Now</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ===================== FEATURES (NO ICONS) ===================== -->
<section class="features-area section_gap bg-light">
    <div class="container">
        <div class="row text-center">
            <% [
                {title:'Free Delivery', text:'On orders above ₹999'},
                {title:'Easy Returns', text:'30-day hassle-free'},
                {title:'24/7 Support', text:'We are always here'},
                {title:'Secure Payment', text:'100% safe transactions'}
            ].forEach(f => { %>
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="single-features p-4 bg-white rounded shadow-sm">
                        <h6 class="fw-bold"><%= f.title %></h6>
                        <p class="text-muted"><%= f.text %></p>
                    </div>
                </div>
            <% }) %>
        </div>
    </div>
</section>

<!-- ===================== CATEGORY GRID – FIXED & CLEAN ===================== -->
<section class="category-area section_gap">
    <div class="container">
        <div class="category-grid">
            <% [
                {img:'c1.jpg', title:'Sneakers'},
                {img:'c2.jpg', title:'Casual'},
                {img:'c3.jpg', title:'Formal'},
                {img:'c4.jpg', title:'Sports'},
                {img:'c5.jpg', title:'Boots'}
            ].forEach(c => { %>
                <div class="category-item">
                    <img src="img/category/<%= c.img %>" alt="<%= c.title %>">
                    <div class="category-overlay"><%= c.title %></div>
                </div>
            <% }) %>
        </div>
    </div>
</section>

<!-- ===================== PRODUCT SLIDERS ===================== -->
<section class="active-product-area section_gap bg-white">
    <!-- LATEST PRODUCTS -->
    <div class="single-product-slider">
        <div class="container">
            <div class="section-title text-center mb-5">
                <h1>Latest Products</h1>
                <p>Fresh arrivals just for you</p>
            </div>
            <div class="row">
                <% latestProducts.forEach(p => { 
                    const discount = p.regularPrice > p.salePrice 
                        ? Math.round((p.regularPrice - p.salePrice)/p.regularPrice*100) 
                        : 0; 
                %>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="single-product position-relative">
                            <% if (discount) { %><span class="discount-badge">–<%= discount %>%</span><% } %>
                            <a href="/product?id=<%= p._id %>">
                                <img src="<%= p.productImage[0] %>" class="img-fluid" alt="<%= p.productName %>">
                            </a>
                            <div class="product-details p-3">
                                <h6 class="fw-bold"><a href="/product?id=<%= p._id %>"><%= p.productName %></a></h6>
                                <div class="price mb-2">
                                    <h6 class="d-inline">₹<%= p.salePrice.toFixed(2) %></h6>
                                    <% if (p.regularPrice > p.salePrice) { %>
                                        <h6 class="l-through d-inline ms-2">₹<%= p.regularPrice.toFixed(2) %></h6>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }) %>
            </div>
        </div>
    </div>

    <!-- COMING (TOP-SELLING) PRODUCTS -->
    <div class="single-product-slider mt-5">
        <div class="container">
            <div class="section-title text-center mb-5">
                <h1>Coming Products</h1>
                <p>Most loved by our customers</p>
            </div>
            <div class="row">
                <% topSelling.forEach(p => { 
                    const discount = p.regularPrice > p.salePrice 
                        ? Math.round((p.regularPrice - p.salePrice)/p.regularPrice*100) 
                        : 0; 
                %>
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="single-product position-relative">
                            <% if (discount) { %><span class="discount-badge">–<%= discount %>%</span><% } %>
                            <a href="/product?id=<%= p._id %>">
                                <img src="<%= p.productImage[0] %>" class="img-fluid" alt="<%= p.productName %>">
                            </a>
                            <div class="product-details p-3">
                                <h6 class="fw-bold"><a href="/product?id=<%= p._id %>"><%= p.productName %></a></h6>
                                <div class="price mb-2">
                                    <h6 class="d-inline">₹<%= p.salePrice.toFixed(2) %></h6>
                                    <% if (p.regularPrice > p.salePrice) { %>
                                        <h6 class="l-through d-inline ms-2">₹<%= p.regularPrice.toFixed(2) %></h6>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }) %>
            </div>
        </div>
    </div>
</section>

<!-- ===================== EXCLUSIVE DEAL WITH FIXED COUNTDOWN ===================== -->
<section class="exclusive-deal-area section_gap" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div class="container">
        <div class="row align-items-center text-white">
            <div class="col-lg-6">
                <h1 class="mb-3">Exclusive Hot Deal!</h1>
                <p class="mb-4">Limited time offer – don’t miss out!</p>
                <div class="clockdiv d-flex justify-content-center mb-4" id="countdown">
                    <div class="clockinner me-4"><h1 class="days">--</h1><span>Days</span></div>
                    <div class="clockinner me-4"><h1 class="hours">--</h1><span>Hours</span></div>
                    <div class="clockinner me-4"><h1 class="minutes">--</h1><span>Mins</span></div>
                    <div class="clockinner"><h1 class="seconds">--</h1><span>Secs</span></div>
                </div>
                <a href="/shop" class="primary-btn">Grab Deal</a>
            </div>
            <div class="col-lg-6 text-center">
                <% const dealProd = topSelling[0] || latestProducts[0]; if (dealProd) { %>
                    <a href="/product?id=<%= dealProd._id %>">
                        <img src="<%= dealProd.productImage[0] %>" class="img-fluid rounded shadow-lg" style="max-height:350px;" alt="">
                    </a>
                    <h4 class="mt-3"><a href="/product?id=<%= dealProd._id %>" class="text-white"><%= dealProd.productName %></a></h4>
                    <div class="price">
                        <h6>₹<%= dealProd.salePrice.toFixed(2) %></h6>
                        <% if (dealProd.regularPrice > dealProd.salePrice) { %>
                            <h6 class="l-through">₹<%= dealProd.regularPrice.toFixed(2) %></h6>
                        <% } %>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</section>

<!-- ===================== DEALS OF THE WEEK (DYNAMIC) ===================== -->
<section class="related-product-area section_gap">
    <div class="container">
        <div class="section-title text-center mb-5">
            <h1>Deals of the Week</h1>
            <p>Hand-picked just for you</p>
        </div>
        <div class="row">
            <div class="col-lg-9">
                <div class="row g-3">
                    <% deals.forEach(p => { 
                        const discount = p.regularPrice > p.salePrice 
                            ? Math.round((p.regularPrice - p.salePrice)/p.regularPrice*100) 
                            : 0; 
                    %>
                        <div class="col-lg-4 col-md-6">
                            <div class="single-related-product d-flex align-items-center bg-white p-3 rounded shadow-sm">
                                <a href="/product?id=<%= p._id %>">
                                    <img src="<%= p.productImage[0] %>" alt="<%= p.productName %>" style="width:80px; height:80px; object-fit:cover; border-radius:8px;">
                                </a>
                                <div class="desc ms-3 flex-grow-1">
                                    <a href="/product?id=<%= p._id %>" class="title d-block fw-bold"><%= p.productName %></a>
                                    <div class="price">
                                        <h6 class="d-inline">₹<%= p.salePrice.toFixed(2) %></h6>
                                        <% if (discount) { %><small class="text-success ms-2">–<%= discount %>%</small><% } %>
                                        <% if (p.regularPrice > p.salePrice) { %>
                                            <h6 class="l-through d-inline ms-2">₹<%= p.regularPrice.toFixed(2) %></h6>
                                        <% } %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }) %>
                </div>
            </div>
            <div class="col-lg-3">
                <a href="/shop"><img src="img/category/c5.jpg" class="img-fluid rounded shadow" alt="Shop All"></a>
            </div>
        </div>
    </div>
</section>

<%- include("../../views/partials/user/footer") %>

<script>
// FIXED COUNTDOWN – Runs once, updates every second
const countdownEnd = new Date().getTime() + 5 * 24 * 60 * 60 * 1000; // 5 days from now

function updateCountdown() {
    const now = new Date().getTime();
    const distance = countdownEnd - now;

    if (distance <= 0) {
        document.getElementById('countdown').innerHTML = '<div class="text-center w-100">Deal Expired!</div>';
        return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

    document.querySelector('.days').textContent = days;
    document.querySelector('.hours').textContent = hours;
    document.querySelector

('.minutes').textContent = minutes;
    document.querySelector('.seconds').textContent = seconds;
}

// Update immediately + every second
updateCountdown();
setInterval(updateCountdown, 1000);
</script>